# API — 기능 상세 도면

## Purpose

BE(FastAPI)와의 모든 HTTP 통신을 담당하는 중앙 계층이다.
단일 Axios 인스턴스(`client.ts`)를 통해 인증 토큰 주입과 전역 에러 처리를 일원화하고,
리소스별 모듈이 엔드포인트 함수를 제공한다.

## Logic

### Axios 인스턴스 동작

```
[컴포넌트 호출]
     │
     ▼
[API 모듈 함수]  예: reservationsApi.getMonthly(2026, 3)
     │
     ▼
[Request Interceptor]
  └→ localStorage에서 access_token 읽기
  └→ Authorization: Bearer <token> 헤더 자동 삽입
     │
     ▼
[HTTP 요청 발송]  → baseURL + endpoint
     │
     ▼
[Response Interceptor]
  ├→ 성공(2xx): response 그대로 반환
  └→ 401: 토큰 삭제 + /login 리디렉트 (자동 로그아웃)
  └→ 그 외: Promise.reject(error) → 호출부에서 처리
```

### 모듈별 엔드포인트 매핑

#### auth.ts
| 함수 | Method | Endpoint | 요청 타입 | 응답 타입 |
|------|--------|----------|----------|----------|
| `kakaoLogin(code)` | POST | `/api/auth/kakao/login` | `{ code: string }` | `AuthResponse` |
| `getMe()` | GET | `/api/auth/me` | — | `User` |

#### users.ts
| 함수 | Method | Endpoint | 요청 타입 | 응답 타입 |
|------|--------|----------|----------|----------|
| `getAll()` | GET | `/api/users` | — | `User[]` |
| `updateMe(data)` | PUT | `/api/users/me` | `{ nickname?, affiliation? }` | `User` |
| `updateRole(userId, role)` | PUT | `/api/users/:id/role` | `{ role: UserRole }` | `User` |

#### notices.ts
| 함수 | Method | Endpoint | 요청 타입 | 응답 타입 |
|------|--------|----------|----------|----------|
| `getAll(page, size)` | GET | `/api/notices?page&size` | query params | `NoticeListResponse` |
| `getById(id)` | GET | `/api/notices/:id` | — | `Notice` |
| `create(data)` | POST | `/api/notices` | `{ title, content }` | `Notice` |
| `update(id, data)` | PUT | `/api/notices/:id` | `{ title?, content? }` | `Notice` |
| `delete(id)` | DELETE | `/api/notices/:id` | — | — |

#### reservations.ts
| 함수 | Method | Endpoint | 요청 타입 | 응답 타입 |
|------|--------|----------|----------|----------|
| `getMonthly(year, month)` | GET | `/api/reservations?year&month` | query params | `Reservation[]` |
| `getById(id)` | GET | `/api/reservations/:id` | — | `ReservationDetail` |
| `create(data)` | POST | `/api/reservations` | `CreateReservationRequest` | `Reservation` |
| `update(id, data)` | PUT | `/api/reservations/:id` | `Partial<CreateReservationRequest>` | `Reservation` |
| `delete(id)` | DELETE | `/api/reservations/:id` | — | — |
| `participate(id)` | POST | `/api/reservations/:id/participate` | — | — |
| `cancelParticipation(id)` | DELETE | `/api/reservations/:id/participate` | — | — |

#### sessions.ts
| 함수 | Method | Endpoint | 요청 타입 | 응답 타입 |
|------|--------|----------|----------|----------|
| `getAll()` | GET | `/api/sessions` | — | `Session[]` |
| `create(data)` | POST | `/api/sessions` | `{ name }` | `Session` |
| `getMySessions()` | GET | `/api/sessions/me` | — | `UserSession[]` |
| `addMySession(data)` | POST | `/api/sessions/me` | `{ session_id, is_main?, skill_level? }` | `UserSession` |
| `updateMySession(id, data)` | PUT | `/api/sessions/me/:id` | `{ is_main?, skill_level? }` | `UserSession` |
| `deleteMySession(id)` | DELETE | `/api/sessions/me/:id` | — | — |

#### teams.ts
| 함수 | Method | Endpoint | 요청 타입 | 응답 타입 |
|------|--------|----------|----------|----------|
| `getAll()` | GET | `/api/teams` | — | `Team[]` |
| `getById(id)` | GET | `/api/teams/:id` | — | `TeamDetail` |
| `create(data)` | POST | `/api/teams` | `{ name, description? }` | `Team` |
| `update(id, data)` | PUT | `/api/teams/:id` | `{ name?, description? }` | `Team` |
| `addMember(teamId, data)` | POST | `/api/teams/:id/members` | `{ user_id, session_id }` | — |
| `removeMember(teamId, userId)` | DELETE | `/api/teams/:id/members/:userId` | — | — |

## Connectivity

| API 모듈 | 사용하는 타입 (`src/types/`) | 소비하는 페이지 (`src/features/`) |
|---------|---------------------------|-------------------------------|
| `auth.ts` | `user.ts` | `auth/pages/KakaoCallbackPage`, `layout/AppLayout` |
| `users.ts` | `user.ts` | `admin/pages/MemberManagementPage` |
| `notices.ts` | `notice.ts` | `notices/pages/NoticeListPage`, `NoticeDetailPage` |
| `reservations.ts` | `reservation.ts` | `calendar/pages/CalendarPage` |
| `sessions.ts` | `session.ts` | (아직 UI 미구현) |
| `teams.ts` | `team.ts` | `teams/pages/TeamListPage` |

## Key Files

| 파일 | 핵심 이유 |
|------|----------|
| `client.ts` | 전체 API 동작의 근간. 인터셉터를 통한 토큰 자동 삽입과 401 전역 처리가 여기서 결정됨. 이 파일의 동작을 모르면 어떤 API 호출도 이해할 수 없음 |
| `reservations.ts` | 엔드포인트가 7개로 가장 많고, 참여/취소 같은 행위형 API를 포함. 앱의 핵심 도메인 |
| `auth.ts` | 인증 흐름의 BE 접점. `AuthResponse` 인터페이스가 이 파일에 로컬 정의됨 |
