# Auth — 기능 상세 도면

## Purpose

카카오 소셜 로그인을 통한 사용자 인증과 JWT 토큰 기반 세션 유지를 담당한다.
이 모듈은 앱 전체의 "로그인 여부"와 "누구인지"를 결정하는 유일한 출처이다.

## Logic

### 로그인 흐름

```
LoginPage                KakaoCallbackPage              authStore
   │                            │                           │
   │  카카오 인가 URL로 리디렉트   │                           │
   │ ──────────────────→        │                           │
   │  (kauth.kakao.com)         │                           │
   │                            │                           │
   │         카카오가 code 전달    │                           │
   │         (/auth/kakao/callback?code=...)                 │
   │                            │                           │
   │                   code → BE에 전달                      │
   │                   POST /api/auth/kakao/login            │
   │                            │                           │
   │                   access_token 수신                     │
   │                   localStorage에 저장                    │
   │                            │                           │
   │                   GET /api/auth/me                      │
   │                   사용자 정보 수신                        │
   │                            │                           │
   │                            │ ── setAuth(user, token) ─→ │
   │                            │                           │
   │                   /calendar로 이동                      │
```

### 인증 복원 (새로고침/재방문)

1. `authStore` 생성 시 `localStorage`에서 토큰 존재 여부 확인 → `isAuthenticated` 초기화
2. `AppLayout` 마운트 시 `isAuthenticated && !user`이면 `GET /api/auth/me` 호출
3. 성공 → `setUser()`, 실패 → `clearAuth()` → `/login` 리디렉트

### 로그아웃 (자동)

- Axios Response Interceptor가 401 수신 시 `localStorage` 토큰 삭제 + `/login` 강제 이동
- 명시적 로그아웃 버튼은 현재 미구현

## Connectivity

| FE 파일 | 연동 API | 역할 |
|---------|---------|------|
| `pages/LoginPage.tsx` | (카카오 외부 URL) | 카카오 인가 요청 리디렉트 |
| `pages/KakaoCallbackPage.tsx` | `POST /api/auth/kakao/login` | 인가 코드 → JWT 교환 |
| `pages/KakaoCallbackPage.tsx` | `GET /api/auth/me` | 토큰으로 사용자 정보 조회 |
| `stores/authStore.ts` | — | 인증 상태 전역 관리 (Zustand) |

**소비처 (이 모듈을 참조하는 곳):**
- `components/layout/AppLayout.tsx` — 인증 가드 + 유저 정보 복원
- `components/layout/Header.tsx` — 프로필 이미지, 닉네임 표시
- `components/layout/BottomNav.tsx` — 역할 기반 메뉴 노출
- `components/guards/AdminGuard.tsx` — 역할 기반 라우트 보호

## Key Files

| 파일 | 핵심 이유 |
|------|----------|
| `stores/authStore.ts` | 앱 전체의 인증 상태 단일 출처. `isAuthenticated`, `user`, `token`을 관리하며 localStorage와 동기화 |
| `pages/KakaoCallbackPage.tsx` | OAuth 핵심 로직 집중. 코드 교환 → 토큰 저장 → 유저 조회 → 스토어 갱신 → 라우팅까지 한 파일에서 수행 |
| `pages/LoginPage.tsx` | 카카오 인가 URL 구성. 환경변수 `VITE_KAKAO_CLIENT_ID`, `VITE_KAKAO_REDIRECT_URI` 사용 |
